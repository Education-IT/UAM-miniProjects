def ex2(a, k, n):
    y = 1
    k_bin = bin(k)
    i = 2
    while i < len(k_bin):
        y = (y * y) % n
        if k_bin[i] == "1":
            y = (y * a) % n
        i = i + 1
    return y

def ex2_op(a,k,n):
    y = 1
    while k > 0:
        if k & 1:
            y = (y * a) % n
        a = (a * a) % n
        k >>= 1
    return y

a = 391391460710934952447744356920347432818302403303325591886976492807319896968025226937614034635791513888335717473023250182271798945302849615194243154049546831368896945330379987670475241933068594152537330597969762722659261563190456905695749170316137931922395119952663460471204126820352679225013665046771
k = 393847041276178206491396243212274945872070776985043237184044451747690284405703994938020592656894726519747568678264497623311685635604918597230323269556886420453871930400418329075629418384691272372863859327955756407280218398219170544142787007265395975232901233778590659508114573048528189504436995545652
n = 557447646341221346636192772896901610558710893835414944403480118710131817164269282839046936145176310843035027195369552947724772574976124889744487830405662539681582010111238770266408227840530530562128937575104894419356210796751265695974980542800695284666417470596597594320307059087588663353662759831096
result = 528740474038432267205220745123477365367902741506986937036584038914079518916591639422924304119091926058516545501678711282547753679382324322137177603605258770905033803638698420415110457206797302067841914402002492455806626708130197412329806624753718919672729660924410862449481710602891055174030073500785
print("\n#----# Example 1. #----#")
print(
      ex2(a, k, n) == ex2_op(a, k, n) and
      result == ex2_op(a, k, n) and
      result == ex2(a, k, n)
     )
print()

#==================================================================

a = 3
k = 1073741824
n = 1267650600228229401496703205375
result = 404294742055422617191248672231
print("#----# Example 2. #----#")
print(
      ex2(a, k, n) == ex2_op(a, k, n) and
      result == ex2_op(a, k, n) and
      result == ex2(a, k, n)
     )
print()

#==================================================================

print("#----# Example 3. #----#")
a = 10
k = 4052555153018976268
n = 4611686018427387914
result = 1120803652654867934
print(
      ex2(a, k, n) == ex2_op(a, k, n) and
      result == ex2_op(a, k, n) and
      result == ex2(a, k, n)
     )